<?xml version="1.0" encoding="utf-8"?>
<odoo>

  <record model="ir.actions.server" id="connect_billing_action">
      <field name="type">ir.actions.server</field>
      <field name="name">Billing</field>
      <field name="state">code</field>
      <field name="model_id" ref="model_connect_settings"/>
      <field name="code">action = model.open_billing_form()</field>
  </record>

  <menuitem id="billing_menu" parent="connect.connect_settings_menu"
      groups="connect.group_connect_admin"
      action="connect_billing_action" name="Billing" sequence="75"/>

  <record id="cancel_subscription_action" model="ir.actions.act_window">
        <field name="name">Cancel Subscription</field>
        <field name="res_model">connect.cancel_subscription_wizard</field>
        <field name="view_mode">form</field>
        <field name="target">new</field>
    </record>

  <record id='connect_billing_form' model='ir.ui.view'>
      <field name='name'>connect_billing_form</field>
      <field name='model'>connect.settings</field>
      <field name='type'>form</field>
      <field name='arch' type='xml'>
        <form create="false" delete="false">
            <sheet>
              <notebook>
                <!-- EULA PAGE  -->
                <page name="eula" string="End User License Agreement" invisible="is_eula_accepted ==  True">
                  <group>
                      <field name="is_subscribed" invisible="1"/>
                      <field name="is_registered" invisible="1"/>
                      <field name="is_eula_accepted" invisible="1"/>
                      <field name="eula"/>
                      <button name="confirm_eula" type="object" string="I Accept" class="btn-primary"
                          colspan="2" confirm="Please confirm that you accept the EULA!"/>
                  </group>
                </page>
                <!-- BILLING PAGE -->
                <page name="connect" string="Connect"
                    invisible="is_eula_accepted ==  False">
                  <button class="me-1 btn btn-primary" name="billing_session_url_action"  type="object" string="PAYMENTS &amp; INVOICES" invisible="is_registered == False"/>
                  <button class="me-1 btn-primary" name="check_balance" type="object" string="CHECK BALANCE" invisible="is_registered == False"/>
                  <button class="me-1 btn btn-primary" name="add_credits" type="object" string="ADD CREDITS" invisible="is_registered == False"/>
                  <button class="me-1 btn btn-success" name="create_subscription" type="object" string="SUBSCRIBE" invisible="is_subscribed == True"  />
                  <button class="me-1 btn btn-danger" name="unsubscribe_product" type="object" string="CANCEL SUBSCRIPTION" invisible="is_subscribed == False or is_registered == False"/>
                  <br/>
                  <small>If you have any issues with the billing, please send us a request to the <a target="_new" href="https://connect.com/helpdesk">Helpdesk</a></small>
                  <group>
                        <group name="billing" string="Billing Data">
                            <field name="admin_name"/>
                            <field name="admin_email"/>
                            <field name="admin_phone"/>
                            <field name="web_base_url"/>
                            <small colspan="2"><i>Company name and email can be changed from Odoo Settings.</i></small>
                            <field name="company_name"/>
                            <field name="company_address"/>
                            <field name="company_phone"/>
                            <field name="company_email"/>
                            <button colspan="2" name="update_billing_data" class="btn btn-primary me-1"  type="object" string="UPDATE BILLING DATA" invisible="is_registered == False"/>
                        </group>
                        <group>
                            <separator string="Webhooks"/>
                            <field name="webhook_region"/>
                            <field name="webhook_fallback_region"/>
                            <button colspan="2" class="btn btn-primary" name="change_billing_region"
                                    type="object" string="SET REGION"/>
                            <separator string="Account"/>
                            <field name="show_partner_code" invisible="1"/>
                            <field name="show_discount_code" invisible="1"/>
                            <field name="registration_id" invisible="is_registered == False"/>
                            <field name="partner_code" invisible="show_partner_code == False" readonly="is_registered == True"/>
                            <field name="discount_code" invisible="show_discount_code == False" readonly="is_subscribed == True"/>
                            <field name="credits" invisible="is_registered != True"/>
                            <field name="twilio_balance" invisible="is_registered != True"/>
                            <field name="is_subscribed" invisible="1"/>
                            <separator string="Subscription Pricing" invisible="is_registered != True or not subscription_pricing"/>
                              <field name="subscription_pricing" nolabel="1" colspan="2"/>
                        </group>
                    </group>
                </page>
              </notebook>
            </sheet>
        </form>
      </field>
  </record>

</odoo>
